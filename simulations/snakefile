configfile: "config.yml"

reps = ["R" + str(item) for item in list(range(1, config["rep"]+1))]

import pandas as pd
grid = pd.read_table(config["grid"])
grid["id"] =  grid.X.astype("str") + "_" +  grid.Y.astype("str")

rule all:
   input:
        expand("results/spinup/sim_{id}_{rep}", id = grid.id, rep=reps)
        
rule spinup:
    input:
        "data/era.tsv",
        "data/correspondence_era.tsv",
        "data/species.tsv",
        "data/soil.tsv"
    output:
        directory("results/spinup/sim_{x}_{y}_{rep}")
    log:
        "results/logs/spinup_{x}_{y}_{rep}.log"
    benchmark:
        "results/benchmarks/spinup_{x}_{y}_{rep}.benchmark.txt"
    singularity:
        config["troll"]
    threads: 1
    params:
        x="{x}",
        y="{y}",
        cra=config["cra"],
        crb=config["crb"],
        m=config["m"],
        a0=config["a0"],
        b0=config["b0"],
        delta=config["delta"],
        test=config["test"]
    script:
        "scripts/spinup.R"
        
# Need to add an extract rule from simulation output to reduce data to download
# back from the server. But at first the full simulations outputs will be kept
# on the server in case we want to extend outputs.
